/*!
 * This file is part of eyeo's Anti-Circumvention Snippets module (@eyeo/snippets),
 * Copyright (C) 2006-present eyeo GmbH
 * 
 * @eyeo/snippets is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 3 as
 * published by the Free Software Foundation.
 * 
 * @eyeo/snippets is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with @eyeo/snippets.  If not, see <http://www.gnu.org/licenses/>.
 */

const callback = (environment, ...filters) => {
const e=Proxy,{apply:t,bind:n,call:o}=Function,r=o.bind(t),i=o.bind(n),s=o.bind(o),c={get:(e,t)=>i(o,e[t])},l=t=>new e(t,c),a={get:(e,t)=>i(e[t],e)},u=t=>new e(t,a),{assign:d,defineProperties:f,freeze:h,getOwnPropertyDescriptor:p,getOwnPropertyDescriptors:g,getPrototypeOf:m}=u(Object),{hasOwnProperty:w}=l({}),{species:b}=Symbol,y={get(e,t){const n=e[t];class o extends n{}const r=g(n.prototype);delete r.constructor,h(f(o.prototype,r));const i=g(n);return delete i.length,delete i.prototype,i[b]={value:o},h(f(o,i))}},v=t=>new e(t,y),S="undefined"!=typeof environment?environment:{};"undefined"==typeof globalThis&&(window.globalThis=window);const{apply:k,ownKeys:x}=u(Reflect),E="world"in S,M=E&&"ISOLATED"===S.world,C=E&&"MAIN"===S.world,T="object"==typeof chrome&&!!chrome.runtime,O="object"==typeof browser&&!!browser.runtime,P=!C&&(M||T||O),W=e=>P?e:L(e,$(e)),{create:L,defineProperties:D,defineProperty:N,freeze:A,getOwnPropertyDescriptor:R,getOwnPropertyDescriptors:$}=u(Object),I=u(globalThis),V=P?globalThis:v(globalThis),{Map:H,RegExp:j,Set:B,WeakMap:F,WeakSet:q}=V,_=(e,t,n=null)=>{const o=x(t);for(const r of x(e)){if(o.includes(r))continue;const i=R(e,r);if(n&&"value"in i){const{value:e}=i;"function"==typeof e&&(i.value=n(e))}N(t,r,i)}},z=e=>{const t=V[e];class n extends t{}const{toString:o,valueOf:r}=t.prototype;D(n.prototype,{toString:{value:o},valueOf:{value:r}});const i=e.toLowerCase(),s=e=>function(){const t=k(e,this,arguments);return typeof t===i?new n(t):t};return _(t,n,s),_(t.prototype,n.prototype,s),n},X=A({frozen:new F,hidden:new q,iframePropertiesToAbort:{read:new B,write:new B},abortedIframes:new F}),U=new j("^[A-Z]");var G=new Proxy(new H([["chrome",P&&(T&&chrome||O&&browser)||void 0],["isExtensionContext",P],["variables",X],["console",W(console)],["document",globalThis.document],["performance",W(performance)],["JSON",W(JSON)],["Map",H],["Math",W(Math)],["Number",P?Number:z("Number")],["RegExp",j],["Set",B],["String",P?String:z("String")],["WeakMap",F],["WeakSet",q],["MouseEvent",MouseEvent]]),{get(e,t){if(e.has(t))return e.get(t);let n=globalThis[t];return"function"==typeof n&&(n=(U.test(t)?V:I)[t]),e.set(t,n),n},has:(e,t)=>e.has(t)});const J={WeakSet:WeakSet,WeakMap:WeakMap,WeakValue:class{has(){return!1}set(){}}},{apply:K}=Reflect;const{Map:Q,WeakMap:Y,WeakSet:Z,setTimeout:ee}=G;let te=!0,ne=e=>{e.clear(),te=!te};var oe=function(e){const{WeakSet:t,WeakMap:n,WeakValue:o}=this||J,r=new t,i=new n,s=new o;return function(t){if(r.has(t))return t;if(i.has(t))return i.get(t);if(s.has(t))return s.get(t);const n=K(e,this,arguments);return r.add(n),n!==t&&("object"==typeof t&&t?i:s).set(t,n),n}}.bind({WeakMap:Y,WeakSet:Z,WeakValue:class extends Q{set(e,t){return te&&(te=!te,ee(ne,0,this)),super.set(e,t)}}});const{concat:re,includes:ie,join:se,reduce:ce,unshift:le}=l([]),ae=v(globalThis),{Map:ue,WeakMap:de}=ae,fe=new ue,he=t=>{const n=(e=>{const t=[];let n=e;for(;n;){if(fe.has(n))le(t,fe.get(n));else{const e=g(n);fe.set(n,e),le(t,e)}n=m(n)}return le(t,{}),r(d,null,t)})("function"==typeof t?t.prototype:t),o={get(e,t){if(t in n){const{value:o,get:r}=n[t];if(r)return s(r,e);if("function"==typeof o)return i(o,e)}return e[t]},set(e,t,o){if(t in n){const{set:r}=n[t];if(r)return s(r,e,o),!0}return e[t]=o,!0}};return t=>new e(t,o)},{isExtensionContext:pe,Array:ge,Number:me,String:we,Object:be}=G,{isArray:ye}=ge,{getOwnPropertyDescriptor:ve,setPrototypeOf:Se}=be,{toString:ke}=be.prototype,{slice:xe}=we.prototype,{get:Ee}=ve(Node.prototype,"nodeType"),Me=pe?{}:{Attr:he(Attr),CanvasRenderingContext2D:he(CanvasRenderingContext2D),CSSStyleDeclaration:he(CSSStyleDeclaration),Document:he(Document),Element:he(Element),HTMLCanvasElement:he(HTMLCanvasElement),HTMLElement:he(HTMLElement),HTMLImageElement:he(HTMLImageElement),HTMLScriptElement:he(HTMLScriptElement),MutationRecord:he(MutationRecord),Node:he(Node),ShadowRoot:he(ShadowRoot),get CSS2Properties(){return Me.CSSStyleDeclaration}},Ce=(e,t)=>{if("Element"!==t&&t in Me)return Me[t](e);if(ye(e))return Se(e,ge.prototype);const n=(e=>s(xe,s(ke,e),8,-1))(e);if(n in Me)return Me[n](e);if(n in G)return Se(e,G[n].prototype);if("nodeType"in e)switch(s(Ee,e)){case 1:if(!(t in Me))throw new Error("unknown hint "+t);return Me[t](e);case 2:return Me.Attr(e);case 3:return Me.Node(e);case 9:return Me.Document(e)}throw new Error("unknown brand "+n)};var Te=pe?e=>e===window||e===globalThis?G:e:oe(((e,t="Element")=>{if(e===window||e===globalThis)return G;switch(typeof e){case"object":return e&&Ce(e,t);case"string":return new we(e);case"number":return new me(e);default:throw new Error("unsupported value")}}));let Oe=!1;function Pe(){return Oe}let{console:We,document:Le,getComputedStyle:De,isExtensionContext:Ne,variables:Ae,Array:Re,MutationObserver:$e,Object:Ie,XPathEvaluator:Ve,XPathExpression:He,XPathResult:je}=Te(window);const{querySelectorAll:Be}=Le,Fe=Be&&i(Be,Le);function qe(e,t=!1){try{const n=navigator.userAgent.includes("Firefox")?e.openOrClosedShadowRoot:browser.dom.openOrClosedShadowRoot(e);return null===n&&Pe()&&!t&&We.log("Shadow root not found or not added in element yet",e),n}catch(n){return Pe()&&!t&&We.log("Error while accessing shadow root",e,n),null}}function _e(e,t=!1){return Ue(e,Fe.bind(Le),Le,t)}function ze(e,t,n,o){const r=t.getAttribute("xlink:href")||t.getAttribute("href");if(r){const s=Fe(r)[0];if(!s&&Pe())return We.log("No elements found matching",r),!1;if(!(i=e)||0===i.length||i.every((e=>""===e.trim()))){const e=o.length>0?o:[];return n.push({element:s,rootParents:[...e,t]}),!1}const c=s.querySelectorAll.bind(s);return{nextBoundElement:s,nestedSelectorsString:e.join("^^"),next$$:c}}var i}function Xe(e,t){const n=qe(t);if(n){const{querySelectorAll:o}=n,r=o&&i(o,n).bind(n);return{nextBoundElement:t,nestedSelectorsString:":host "+e.join("^^"),next$$:r}}return!1}function Ue(e,t,n,o,r=[]){if(e.includes("^^")){const[i,s,...c]=e.split("^^");let l,a;switch(s){case"svg":a=ze;break;case"sh":a=Xe;break;default:return Pe()&&We.log(s," is not supported. Supported commands are: \n^^sh^^\n^^svg^^"),[]}l=""===i.trim()?[n]:t(i);const u=[];for(const e of l){const t=a(c,e,u,r);if(!t)continue;const{next$$:n,nestedSelectorsString:i,nextBoundElement:s}=t,l=Ue(i,n,s,o,[...r,e]);l&&u.push(...l)}return u}const i=t(e);return o?[...i].map((e=>({element:e,rootParents:r.length>0?r:[]}))):i}function Ge(e,t,n=[]){if(t.includes("^^svg^^")&&(t=t.split("^^svg^^")[0]),t.includes("^^sh^^")){const o=t.split("^^sh^^"),r=o.length-1;if(t=`:host ${o[r]}`,r===n.length)return e.closest(t);return n[r].closest(t)}return n[0]?n[0].closest(t):e.closest(t)}const{assign:Je,setPrototypeOf:Ke}=Ie;class Qe extends He{evaluate(...e){return Ke(r(super.evaluate,this,e),je.prototype)}}class Ye extends Ve{createExpression(...e){return Ke(r(super.createExpression,this,e),Qe.prototype)}}function Ze(e){if(Ae.hidden.has(e))return!1;!function(e){Ne&&"function"==typeof checkElement&&checkElement(e)}(e),Ae.hidden.add(e);let{style:t}=Te(e),n=Te(t,"CSSStyleDeclaration"),o=Te([]),{debugCSSProperties:r}=S;for(let[e,t]of r||[["display","none"]])n.setProperty(e,t,"important"),o.push([e,n.getPropertyValue(e)]);return new $e((()=>{for(let[e,t]of o){let o=n.getPropertyValue(e),r=n.getPropertyPriority(e);o==t&&"important"==r||n.setProperty(e,t,"important")}})).observe(e,{attributes:!0,attributeFilter:["style"]}),!0}function et(e){let t=e;if(t.startsWith("xpath(")&&t.endsWith(")")){let e=t.slice(6,-1),n=(new Ye).createExpression(e,null),o=je.ORDERED_NODE_SNAPSHOT_TYPE;return e=>{if(!e)return;let t=n.evaluate(Le,o,null),{snapshotLength:r}=t;for(let n=0;n<r;n++)e(t.snapshotItem(n))}}return t=>_e(e).forEach(t)}function tt(e,t,n,o){let r;null==n&&(n=t);const i=()=>{for(const{element:i,rootParents:s}of _e(n,!0)){const n=Ge(Te(i),t,s);n&&e(i,n,s)&&(r(),Ze(n)&&"function"==typeof o&&o(n))}};return Je(new $e(i),{race(e){r=e,this.observe(Le,{childList:!0,characterData:!0,subtree:!0}),i()}})}function nt(e,t,n,o){let r=Te(t,"CSSStyleDeclaration");if("none"==r.getPropertyValue("display"))return!1;let i=r.getPropertyValue("visibility");if("hidden"==i||"collapse"==i)return!1;if(!n||e==n)return!0;let s=Te(e).parentElement;if(!s){if(!o||!o.length)return!0;s=o[o.length-1],o=o.slice(0,-1)}return nt(s,De(s),n,o)}function ot(e){let t=De(e),{cssText:n}=t;if(n)return n;for(let e of t)n+=`${e}: ${t[e]}; `;return Te(n).trim()}let{Math:rt,RegExp:it}=Te(window);function st(e){let{length:t}=e;if(t>1&&"/"===e[0]){let n="/"===e[t-1];if(n||t>2&&Te(e).endsWith("/i")){let t=[Te(e).slice(1,n?-1:-2)];return n||t.push("i"),new it(...t)}}return new it(Te(e).replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"))}const{console:ct}=Te(window),lt=()=>{};function at(...e){if(Pe()){const t=["%c DEBUG","font-weight: bold;"],n=e.indexOf("error"),o=e.indexOf("warn"),r=e.indexOf("success"),i=e.indexOf("info");-1!==n?(t[0]+=" - ERROR",t[1]+="color: red; border:2px solid red",Te(e).splice(n,1)):-1!==o?(t[0]+=" - WARNING",t[1]+="color: orange; border:2px solid orange ",Te(e).splice(o,1)):-1!==r?(t[0]+=" - SUCCESS",t[1]+="color: green; border:2px solid green",Te(e).splice(r,1)):-1!==i&&(t[1]+="color: black;",Te(e).splice(i,1)),Te(e).unshift(...t)}ct.log(...e)}function ut(e){return i(Pe()?at:lt,null,e)}let{Array:dt,Error:ft,Map:ht,parseInt:pt}=Te(window),gt=null,mt=null;function wt(e,t){if(null===gt)return lt;let n=gt,{participants:o}=n;return o.set(r,t),r;function r(){if(n.winners<1)return;if(ut("race")("success",`${e} won the race`),n===gt)mt.push(r);else if(o.delete(r),--n.winners<1){for(let e of o.values())e();o.clear()}}}const bt={get(e,t){const n=e;for(;!w(e,t);)e=m(e);const{get:o,set:i}=p(e,t);return function(){return arguments.length?r(i,n,arguments):s(o,n)}}};var yt;function vt(e,t,n){var o,r;n?"load"===n?(e("info","Waiting until window.load"),window.addEventListener("load",(()=>{e("info","Window.load fired."),t()}))):"loading"===n||"interactive"===n||"complete"===n?(e("info","Waiting document state until :",n),document.addEventListener("readystatechange",(()=>{e("info","Document state changed:",document.readyState),document.readyState===n&&t()}))):(e("info","Waiting until ",n," event is triggered on document"),(o=document,r=n,new Promise((e=>{const t=()=>{o.removeEventListener(r,t),e()};o.addEventListener(r,t)}))).then((()=>{e("info",n," is triggered on document, starting the snippet"),t()})).catch((t=>{e("error","There was an error while waiting for the event.",t)}))):t()}Te(window),yt=window,new e(yt,bt),Te(/^\d+$/);let{MutationObserver:St,WeakSet:kt,getComputedStyle:xt}=Te(window);let{clearTimeout:Et,fetch:Mt,getComputedStyle:Ct,setTimeout:Tt,Map:Ot,MutationObserver:Pt,Uint8Array:Wt}=Te(window);let Lt=new Ot;function Dt(e,{as:t="arrayBuffer",cleanup:n=6e4}={}){let o=t+":"+e,r=Lt.get(o)||{remove:()=>Lt.delete(o),result:null,timer:0};return Et(r.timer),r.timer=Tt(r.remove,n),r.result||(r.result=Mt(e).then((e=>e[t]())).catch(r.remove),Lt.set(o,r)),r.result}const{parseFloat:Nt,Math:At,MutationObserver:Rt,WeakSet:$t}=Te(window),{min:It}=At,Vt=(e,t)=>{const n=e.length+1,o=t.length+1,r=[[0]];let i=0,s=0;for(;++i<o;)r[0][i]=i;for(i=0;++i<n;){const n=e[s];let c=0,l=0;for(r[i]=[i];++c<o;)r[i][c]=It(r[s][c]+1,r[i][l]+1,r[s][l]+(n!=t[l])),++l;++s}return r[n-1][o-1]};let{getComputedStyle:Ht,Map:jt,WeakSet:Bt,parseFloat:Ft}=Te(window);const{ELEMENT_NODE:qt,TEXT_NODE:_t}=Node;let{MutationObserver:zt,WeakSet:Xt,getComputedStyle:Ut}=Te(window);let{getComputedStyle:Gt,MutationObserver:Jt,WeakSet:Kt}=Te(window);Te(window);const Qt={mark(){},end(){},toString:()=>"{mark(){},end(){}}"};function Yt(e,t=10){return Qt}let{MutationObserver:Zt,WeakSet:en}=Te(window);const{ELEMENT_NODE:tn}=Node;let{MutationObserver:nn,WeakSet:on}=Te(window);const{ELEMENT_NODE:rn}=Node;let{parseInt:sn,setTimeout:cn,Error:ln,MouseEvent:an,MutationObserver:un,WeakSet:dn}=Te(window);const fn=["auxclick","click","dblclick","gotpointercapture","lostpointercapture","mouseenter","mousedown","mouseleave","mousemove","mouseout","mouseover","mouseup","pointerdown","pointerenter","pointermove","pointerover","pointerout","pointerup","pointercancel","pointerleave"];let{isNaN:hn,MutationObserver:pn,parseInt:gn,parseFloat:mn,setTimeout:wn}=Te(window);const bn={log:at,race:function(e,t="1"){switch(e){case"start":gt={winners:pt(t,10)||1,participants:new ht},mt=new dt;break;case"end":case"finish":case"stop":gt=null;for(let e of mt)e();mt=null;break;default:throw new ft(`Invalid action: ${e}`)}},debug:function(){Oe=!0},"hide-if-matches-xpath":function(e,t){const{mark:n,end:o}=Yt(),r=ut("hide-if-matches-xpath"),i=t=>{const i=et(`xpath(${e})`),s=new en,c=()=>{n(),i((t=>{if(s.has(t))return!1;s.add(t),a(),Te(t).nodeType===tn?Ze(t):Te(t).textContent="",r("success","Matched: ",t," for selector: ",e)})),o()},l=new Zt(c),a=wt("hide-if-matches-xpath",(()=>l.disconnect()));l.observe(t,{characterData:!0,childList:!0,subtree:!0}),c()};if(t){let e,n=0;const o=et(`xpath(${t})`),r=()=>{o((e=>{i(e),n++})),n>0&&e.disconnect()};e=new Zt(r),e.observe(document,{characterData:!0,childList:!0,subtree:!0}),r()}else i(document)},"hide-if-matches-computed-xpath":function(e,t,n,o){const{mark:r,end:i}=Yt(),s=ut("hide-if-matches-computed-xpath");if(!t||!e)return void s("error","No query or searchQuery provided.");const c=t=>{const n=(t=>e.replace("{{}}",t))(t);s("info","Starting hiding elements that match query: ",n);const o=et(`xpath(${n})`),c=new on,l=()=>{r(),o((t=>{if(c.has(t))return!1;c.add(t),u(),Te(t).nodeType===rn?Ze(t):Te(t).textContent="",s("success","Matched: ",t," for selector: ",e)})),i()},a=new nn(l),u=wt("hide-if-matches-computed-xpath",(()=>a.disconnect()));a.observe(document,{characterData:!0,childList:!0,subtree:!0}),l()},l=st(n);vt(s,(()=>{if(t){s("info","Started searching for: ",t);const e=new on;let n;const o=et(`xpath(${t})`),r=()=>{o((t=>{if(e.has(t))return!1;if(e.add(t),s("info","Found node: ",t),t.innerHTML){s("info","Searching in: ",t.innerHTML);const e=t.innerHTML.match(l);if(e&&e.length){let t="";t=e[1]?e[1]:e[0],s("info","Matched search query: ",t),c(t)}}}))};n=new nn(r),n.observe(document,{characterData:!0,childList:!0,subtree:!0}),r()}}),o)},"hide-if-contains":function(e,t="*",n=null){const o=ut("hide-if-contains");let r=st(e);const i=tt((e=>r.test(Te(e).textContent)),t,n,(e=>{o("success","Matched: ",e," for selector: ",t,n)}));i.race(wt("hide-if-contains",(()=>{i.disconnect()})))},"hide-if-contains-similar-text":function(e,t,n=null,o=0,r=0){const i=new $t,s=ut("hide-if-contains-similar-text"),c=Te(e),{length:l}=c,a=l+Nt(o)||0,u=Te([...c]).sort(),d=Nt(r)||1/0;null==n&&(n=t),s("Looking for similar text: "+c);const f=()=>{for(const{element:e,rootParents:r}of _e(n,!0)){if(i.has(e))continue;i.add(e);const{innerText:n}=Te(e),l=It(d,n.length-a+1);for(let i=0;i<l;i++){const l=Te(n).substr(i,a);if(Vt(u,Te([...l]).sort())-o<=0){const n=Ge(Te(e),t,r);if(s("success","Found similar text: "+c,n),n){p(),Ze(n);break}}}}};let h=new Rt(f),p=wt("hide-if-contains-similar-text",(()=>h.disconnect()));h.observe(document,{childList:!0,characterData:!0,subtree:!0}),f()},"hide-if-contains-visible-text":function(e,t,n=null,...o){let r=Te([]);const i=new jt([["-snippet-box-margin","2"],["-disable-bg-color-check","false"],["-check-is-contained","false"]]);for(let e of o){e=Te(e);let t=e.indexOf(":");if(t<0)continue;let n=e.slice(0,t).trim().toString(),o=e.slice(t+1).trim().toString();n&&o&&(i.has(n)?i.set(n,o):r.push([n,o]))}let s=Te([["opacity","0"],["font-size","0px"],["color","rgba(0, 0, 0, 0)"]]),c=new jt(s.concat(r));function l(e,t,{bgColorCheck:n=!0}={}){t||(t=Ht(e)),t=Te(t);for(const[e,n]of c){if(st(n).test(t.getPropertyValue(e)))return!1}let o=t.getPropertyValue("color");return!n||t.getPropertyValue("background-color")!=o}function a(e,t,{bgColorCheck:n=!0}={}){let o=Ht(e,t);if(!nt(e,o)||!l(e,o,{bgColorCheck:n}))return"";let{content:r}=Te(o);if(r&&"none"!==r){let t=Te([]);return r=Te(r).trim().replace(/(["'])(?:(?=(\\?))\2.)*?\1/g,(e=>""+(t.push(Te(e).slice(1,-1))-1))),r=r.replace(/\s*attr\(\s*([^\s,)]+)[^)]*?\)\s*/g,((t,n)=>Te(e).getAttribute(n)||"")),r.replace(/\x01(\d+)/g,((e,n)=>t[n]))}return""}function u(e,t,{boxMargin:n=2}={}){const o=Te(e).getBoundingClientRect(),r=Te(t).getBoundingClientRect(),i=r.left-n,s=r.right+n,c=r.top-n,l=r.bottom+n;return i<=o.left&&o.left<=s&&c<=o.top&&o.top<=l&&c<=o.bottom&&o.bottom<=l&&i<=o.right&&o.right<=s}function d(e,t,n,o,r,i,{boxMargin:s=2,bgColorCheck:c,checkIsContained:f}={}){let h=!n;if(h&&(n=Ht(e)),!nt(e,n,h&&t,i))return"";o||"hidden"!==Te(n).getPropertyValue("overflow-x")&&"hidden"!==Te(n).getPropertyValue("overflow-y")||(o=e);let p=a(e,":before",{bgColorCheck:c});for(let t of function(e,t=!0){const n=qe(e,t);return n?n.childNodes:Te(e).childNodes}(Te(e)))switch(Te(t).nodeType){case qt:p+=d(t,e,Ht(t),o,r,i,{boxMargin:s,bgColorCheck:c,checkIsContained:f});break;case _t:if(o)u(e,o,{boxMargin:s})&&l(e,n,{bgColorCheck:c})&&(p+=Te(t).nodeValue);else if(l(e,n,{bgColorCheck:c})){if(f&&!u(e,r,{boxMargin:s}))continue;p+=Te(t).nodeValue}}return p+a(e,":after",{bgColorCheck:c})}const f=i.get("-snippet-box-margin"),h=Ft(f)||0,p=!("true"===i.get("-disable-bg-color-check")),g="true"===i.get("-check-is-contained");let m=st(e),w=new Bt;const b=tt(((e,t,n)=>{if(w.has(e))return!1;w.add(e);let o=d(e,t,null,null,e,n,{boxMargin:h,bgColorCheck:p,checkIsContained:g}),r=m.test(o);return Pe()&&o.length&&at(r?"success":"info",r,m,o),r}),t,n);b.race(wt("hide-if-contains-visible-text",(()=>{b.disconnect()})))},"hide-if-contains-and-matches-style":function(e,t="*",n=null,o=null,r=null,i,s=null,c=null){const l=ut("hide-if-contains-and-matches-style"),a=new kt,u=Pe()&&new kt;null==n&&(n=t);const d=st(e),f=o?st(o):null,h=r?st(r):null;vt(l,(()=>{const e=()=>{if(!(s&&window.innerWidth<s||c&&window.innerWidth>c))for(const{element:e,rootParents:o}of _e(n,!0))if(!a.has(e)&&d.test(Te(e).textContent))if(!h||h.test(ot(e))){const n=Ge(Te(e),t,o);if(!n)continue;if(!f||f.test(ot(n)))r(),Ze(n),a.add(e),l("success","Matched: ",n,"which contains: ",e," for params: ",...arguments);else{if(!u||u.has(n))continue;l("info","In this element the searchStyle matched but style didn't:\n",n,xt(n),...arguments),u.add(n)}}else{if(!u||u.has(e))continue;l("info","In this element the searchStyle didn't match:\n",e,xt(e),...arguments),u.add(e)}},o=new St(e),r=wt("hide-if-contains-and-matches-style",(()=>o.disconnect()));o.observe(document,{childList:!0,characterData:!0,subtree:!0}),e()}),i)},"hide-if-has-and-matches-style":function(e,t="*",n=null,o=null,r=null,i=null,s=null,c=null){const l=ut("hide-if-has-and-matches-style"),a=new Xt,u=Pe()&&new Xt;null==n&&(n=t);const d=o?st(o):null,f=r?st(r):null;vt(l,(()=>{const o=()=>{if(!(s&&window.innerWidth<s||c&&window.innerWidth>c))for(const{element:o,rootParents:r}of _e(n,!0))if(!a.has(o))if(!Te(o).querySelector(e)||f&&!f.test(ot(o))){if(!u||u.has(o))continue;l("info","In this element the searchStyle didn't match:\n",o,Ut(o),...arguments),u.add(o)}else{const e=Ge(Te(o),t,r);if(!e||d&&!d.test(ot(e))){if(!u||u.has(e))continue;l("info","In this element the searchStyle matchedbut style didn't:\n",e,Ut(e),...arguments),u.add(e)}else i(),Ze(e),a.add(o),l("success","Matched: ",e,"which contains: ",o," for params: ",...arguments)}},r=new zt(o),i=wt("hide-if-has-and-matches-style",(()=>r.disconnect()));r.observe(document,{childList:!0,subtree:!0}),o()}),i)},"hide-if-labelled-by":function(e,t,n=null){let o=null==n,r=st(e),i=new Kt,s=()=>{for(const{element:e,rootParents:s}of _e(t,!0)){let t=o?e:Ge(Te(e),n,s);if(!t||!nt(e,Gt(e),t))continue;let c=Te(e).getAttribute("aria-labelledby"),a=()=>{i.has(t)||r.test(Te(e).getAttribute("aria-label")||"")&&(l(),i.add(t),Ze(t))};if(c)for(let e of Te(c).split(/\s+/)){let n=Te(document).getElementById(e);n?!i.has(n)&&r.test(n.innerText)&&(l(),i.add(n),Ze(t)):a()}else a()}},c=new Jt(s),l=wt("hide-if-labelled-by",(()=>c.disconnect()));c.observe(document,{characterData:!0,childList:!0,subtree:!0}),s()},"hide-if-contains-image":function(e,t,n){null==n&&(n=t);let o=st(e);const r=ut("hide-if-contains-image");let i=()=>{for(const{element:e,rootParents:i}of _e(n,!0)){let n=Ct(e),s=Te(n["background-image"]).match(/^url\("(.*)"\)$/);s&&Dt(s[1]).then((n=>{if(o.test(new Wt(n).reduce(((e,t)=>e+function(e,t=2){let n=Te(e).toString(16);n.length<t&&(n=Te("0").repeat(t-n.length)+n);return n}(t)),""))){let n=Ge(Te(e),t,i);n&&(c(),Ze(n),r("success","Matched: ",n," for:",...arguments))}}))}},s=new Pt(i),c=wt("hide-if-contains-image",(()=>s.disconnect()));s.observe(document,{childList:!0,subtree:!0}),i()},"simulate-mouse-event":function(...e){const t=ut("simulate-mouse-event");if(e.length<1)throw new ln("[simulate-mouse-event snippet]: No selector provided.");e.length>7&&(e=e.slice(0,7));const n=Te([]);function o(){return n.forEach((e=>{if(!e.found){(function(e){let t=e;if(t.startsWith("xpath(")&&t.endsWith(")")){let t=et(e);return()=>{let e=Te([]);return t((t=>e.push(t))),e}}return()=>Re.from(_e(e))})(e.selector)().length>0&&(e.found=!0)}})),n.every((e=>e.found))}function r(e,n,o){e&&n&&("click"===n&&e.click?(e.click(),t("success","Clicked on this node:\n",e,"\nwith a delay of",o,"ms")):(e.dispatchEvent(new an(n,{bubbles:!0,cancelable:!0})),t("success","A",n,"event was dispatched with a delay of",o,"ms on this node:\n",e)))}Te(e).forEach((e=>{const o=function(e){if(!e)return null;const n={selector:"",continue:!1,trigger:!1,event:"click",delay:"500",clicked:!1,found:!1},o=e.split("$");let r=[];o.length>=2&&(r=o[1].toLowerCase().split(",")),[n.selector]=o;for(const e of r)if("trigger"===e)n.trigger=!0;else if("continue"===e)n.continue=!0;else if(e.startsWith("event")){const t=e.toLowerCase().split("=");t[1]?n.event=t[1]:n.event="click"}else if(e.startsWith("delay")){const t=e.toLowerCase().split("=");t[1]?n.delay=t[1]:n.delay="500"}return fn.includes(n.event)||t("warn",n.event," might be misspelled, check for typos.\n","These are the supported events:",fn),n}(e);n.push(o)}));let i=!1;const[s]=n.slice(-1);s.trigger=!0;let c=new dn;function l(){if(i||(i=o()),i)for(const e of n){const t=et(e.selector),n=sn(e.delay,10);e.trigger&&t((t=>{c.has(t)||(c.add(t),e.continue?setInterval((()=>{r(t,e.event,e.delay)}),n):cn((()=>{r(t,e.event,e.delay)}),n))}))}}new un(l).observe(document,{childList:!0,subtree:!0}),l()},"skip-video":function(e,t,...n){const o=new Map([["-max-attempts","10"],["-retry-ms","10"],["-run-once","false"],["-wait-until",""],["-skip-to","-0.1"],["-stop-on-video-end","false"]]);for(let e of n){e=Te(e);let t=e.indexOf(":");if(t<0)continue;let n=e.slice(0,t).trim().toString(),r=e.slice(t+1).trim().toString();n&&r&&o.has(n)&&o.set(n,r)}const r=o.get("-max-attempts"),i=gn(r||10,10),s=o.get("-retry-ms"),c=gn(s||10,10),l="true"===o.get("-run-once"),a=o.get("-skip-to"),u=mn(a||-.1),d=o.get("-wait-until"),f="true"===o.get("-stop-on-video-end"),h=ut("skip-video"),p=et(`xpath(${t})`);let g=!1;vt(h,(()=>{const n=(s=0)=>{g&&l?o&&o.disconnect():p((o=>{h("info","Matched: ",o," for selector: ",t),h("info","Running video skipping logic.");const l=_e(e)[0];for(;hn(l.duration)&&s<i;)return void wn((()=>{const e=s+1;h("info","Running video skipping logic. Attempt: ",e),n(e)}),c);const a=l.duration-l.currentTime<.5;hn(l.duration)||f&&a||(l.muted=!0,h("success","Muted video..."),u<=0?l.currentTime=l.duration+u:l.currentTime+=u,h("success","Skipped duration..."),l.paused&&l.play(),g=!0,r())}))},o=new pn(n),r=wt("skip-video",(()=>o.disconnect()));o.observe(document,{characterData:!0,childList:!0,subtree:!0}),n()}),d)}};
const snippets=bn;
let context;
for (const [name, ...args] of filters) {
if (snippets.hasOwnProperty(name)) {
try { context = snippets[name].apply(context, args); }
catch (error) { console.error(error); }
}
}
context = void 0;
};
const graph = new Map([["log",null],["race",null],["debug",null],["hide-if-matches-xpath",null],["hide-if-matches-computed-xpath",null],["hide-if-contains",null],["hide-if-contains-similar-text",null],["hide-if-contains-visible-text",null],["hide-if-contains-and-matches-style",null],["hide-if-has-and-matches-style",null],["hide-if-labelled-by",null],["hide-if-contains-image",null],["simulate-mouse-event",null],["skip-video",null]]);
callback.get = snippet => graph.get(snippet);
callback.has = snippet => graph.has(snippet);
export default callback;